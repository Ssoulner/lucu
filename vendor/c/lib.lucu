import "core:"

##
# libc, defined as an effect
# every header file in libc is its own effect
# this is a compound effect that contains all of them
##
@foreign
effect lib {
	fun time(mut t ?^time_t) time_t

	fun puts(s string) int
	fun strlen(s string) size_t

	fun malloc(size size_t) voidptr
	fun free(ptr voidptr)
}

fun malloc_t(size size_t) ^`t / lib {
	cast malloc(size)
}

fun free_t(ptr ^`t) / lib {
	free(cast ptr)
}

struct int   (_ core.int)
struct size_t(_ core.usize)
struct time_t(timestamp int)

struct voidptr(_ ^u8)
struct string (_ ^u8)

@capability
fun link() impl lib / foreign {
	impl_link("c")
}
