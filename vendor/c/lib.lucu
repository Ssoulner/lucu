import "core:"

##
# libc, defined as an effect
# every header file in libc is its own effect
# this is a compound effect that contains all of them
##
@foreign
effect lib {
	fun time(mut t ?^time_t) time_t

	fun puts(s string) int
	fun strlen(s string) size_t

	fun malloc(size size_t) ?^void
	fun free(ptr ?^void)
}

fun malloc_t(size size_t) ?^`t / lib {
	cast malloc(size)
}

fun free_t(ptr ?^`t) / lib {
	free(cast ptr)
}

# opaque types
struct time_t (_timestamp int)
struct void   (_ u8)

# type aliases
type string = ^u8
type int    = core.i32
type size_t = core.usize

@capability
fun link() impl lib / foreign {
	impl_link("c")
}
